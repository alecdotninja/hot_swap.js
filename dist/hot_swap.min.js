!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e):function(e){return t(e)}:e.HotSwap=t(e)}("undefined"!=typeof window?window:this,function(e){"use strict";function t(){return this instanceof t?(this.addedNodes=[],void(this.removedNodes=[])):new t}function n(e){return this instanceof n?(this._initializeOptions(e),this._initializeMutationManger(),void this._performMutation()):new n(e)}var r=e.document,i=r.documentElement,o=e.history;if(t.prototype={addedNodes:null,removedNodes:null,replaceNode:function(e,t){var n=e.parentNode;if(null===n)throw new Error("Cannot replace orphaned node");n.insertBefore(t,e),n.removeChild(e),this.addedNodes.push(t),this.removedNodes.push(e)},appendChildNodes:function(e,t){for(var n;null!==(n=t.firstChild);)e.appendChild(n),this.addedNodes.push(n)},prependChildNodes:function(e,t){var n,r=e.firstChild;if(null!==r)for(;null!==(n=t.firstChild);)e.insertBefore(n,r),this.addedNodes.push(n);else this.appendChildNodes(e,t)},replaceChildNodes:function(e,t){for(var n;null!==(n=e.firstChild);)e.removeChild(n),this.removedNodes.push(n);this.appendChildNodes(e,t)},collectAddedScriptElements:function(){for(var e,t=Array.prototype.push,n=this.addedNodes,r=[],i=0,o=n.length;o>i;i++)e=n[i],"SCRIPT"===e.tagName&&r.push(e),t.apply(r,e.querySelectorAll("SCRIPT"));return r},executeAddedScriptElements:function(){for(var e,t=this.collectAddedScriptElements(),n=0,r=t.length;r>n;n++)e=t[n],this._executeScriptElement(e)},_executeScriptElement:function(e){for(var t,n=r.createElement("SCRIPT"),i=e.attributes,o=0,a=i.length;a>o;o++)t=i[o],e.hasAttribute(t.name)&&n.setAttribute(t.name,t.value);var d=e.textContent;d.length>0&&e.appendChild(r.createTextNode(d))}},n.DEFAULT_OPTIONS={title:function(){var e=this.replacementDocument.querySelector("TITLE");return e?e.textContent:r.title},url:function(){return r.location.href},method:"GET",data:null,replace:function(){return this.getOption("replaceChildren")||this.getOption("appendChildren")||this.getOption("prependChildren")?!1:"BODY"},replaceChildren:!1,appendChildren:!1,prependChildren:!1,keepTitle:!1,keepPath:!1},n.createMutationManager=t,n.HTML_DOCUMENT_MIME_TYPE="text/html, application/xhtml+xml, application/xml",n.createRequestForHTML=function(e,t,i){var o=new XMLHttpRequest;return o.open(e,t,!0),o.setRequestHeader("Accept",n.HTML_DOCUMENT_MIME_TYPE),o.setRequestHeader("X-XHR-Referer",r.location.href),o.send(i),o},n.PROPER_DOCUMENT_MATCHER=/<(html|body)/i,n.parseDocument=function(e,t){t=t||r;var i=t.createElement("HTML");if(n.PROPER_DOCUMENT_MATCHER.test(e))i.innerHTML=e;else{var o=t.createElement("HEAD"),a=t.createElement("BODY");i.appendChild(o),i.appendChild(a),a.innerHTML=e}return i},n.EVENT_NAMESPACE="hot-swap",n.prototype={options:null,_optionCache:null,_initializeOptions:function(e){this._optionCache={},this.options=e||{}},getOption:function(e){if(!(e in this._optionCache)){var t=this.options[e];"function"==typeof t&&(t=t.call(this,this)),t===!1||t||(t=n.DEFAULT_OPTIONS[e]),"function"==typeof t&&(t=t.call(this,this)),this._optionCache[e]=t}return this._optionCache[e]},_mutationManger:null,_initializeMutationManger:function(){this._mutationManger=n.createMutationManager()},getAddedNodes:function(){return this._mutationManger.addedNodes},getRemovedNodes:function(){return this._mutationManger.removedNodes},_performMutation:function(){this.getOption("content")?this._performMutationFromLocalContent():this._performMutationFromRemoteContent()},request:null,_performMutationFromRemoteContent:function(){this._notifyDocument("before-load",function(){this.request=n.createRequestForHTML(this.getOption("method"),this.getOption("url"),this.getOption("data")),this.request.addEventListener("load",function(){this.replacementContent=this.request.responseText,this._notifyDocument("loaded",function(){this._performMutationFromLocalContent()})}.bind(this),!1),this.request.addEventListener("error",function(){this._notifyDocument("load-error")}.bind(this),!1)})},replacementContent:null,replacementDocument:null,_performMutationFromLocalContent:function(){this.replacementDocument=n.parseDocument(this.replacementContent),this._notifyDocument("before-mutation",function(){this.getOption("replace")&&this._replaceBySelector(this.getOption("replace")),this.getOption("replaceChildren")&&this._replaceChildrenBySelector(this.getOption("replaceChildren")),this.getOption("appendChildren")&&this._appendChildrenBySelector(this.getOption("appendChildren")),this.getOption("prependChildren")&&this._prependChildrenBySelector(this.getOption("prependChildren")),!this.getOption("keepTitle")&&this.getOption("title")&&(r.title=this.getOption("title")),!this.getOption("keepPath")&&this.getOption("url")&&o.replaceState(o.state,r.title,this.getOption("url")),this._mutationManger.executeAddedScriptElements(),this._notifyDocument("mutated")})},_notifyDocument:function(e,t){var i="function"==typeof t,o=r.createEvent("Events");o.data=this,o.initEvent(n.EVENT_NAMESPACE+":"+e,!0,i);var a=!r.dispatchEvent(o);i&&!a&&t.call(this,o)},_matchNodesBySelector:function(e){var t=[],n=i.querySelectorAll(e),r=this.replacementDocument.querySelectorAll(e);if(n.length!==r.length)throw new Error("Cannot match nodes by ambiguous selector: "+e);for(var o,a,d=0,l=n.length;l>d;d++)o=n[d],a=r[d],t.push({currentNode:o,replacementNode:a});return t},_replaceBySelector:function(e){for(var t,n=this._matchNodesBySelector(e),r=0,i=n.length;i>r;r++)t=n[r],this._mutationManger.replaceNode(t.currentNode,t.replacementNode)},_replaceChildrenBySelector:function(e){for(var t,n=this._matchNodesBySelector(e),r=0,i=n.length;i>r;r++)t=n[r],this._mutationManger.replaceChildNodes(t.currentNode,t.replacementNode)},_appendChildrenBySelector:function(e){for(var t,n=this._matchNodesBySelector(e),r=0,i=n.length;i>r;r++)t=n[r],this._mutationManger.appendChildNodes(t.currentNode,t.replacementNode)},_prependChildrenBySelector:function(e){for(var t,n=this._matchNodesBySelector(e),r=0,i=n.length;i>r;r++)t=n[r],this._mutationManger.prependChildNodes(t.currentNode,t.replacementNode)}},r.addEventListener("click",function(e){if(!e.defaultPrevented){for(var t=e.target||e.srcElement;t&&"A"!==t.tagName;)t=t.parentElement;t&&(t.hasAttribute("data-replace")||t.hasAttribute("data-replace-children")||t.hasAttribute("data-append-children")||t.hasAttribute("data-prepend-children"))&&(e.preventDefault(),n({url:t.href,method:t.getAttribute("data-method"),replace:t.getAttribute("data-replace"),replaceChildren:t.getAttribute("data-replace-children"),appendChildren:t.getAttribute("data-append-children"),prependChildren:t.getAttribute("data-prepend-children"),keepTitle:t.hasAttribute("data-keep-title"),keepPath:t.hasAttribute("data-keep-path")}))}},!1),r.addEventListener("submit",function(e){if(!e.defaultPrevented){for(var t=e.target||e.srcElement;t&&"form"!==t.tagName;)t=t.parentElement;t&&(t.hasAttribute("data-replace")||t.hasAttribute("data-replace-children")||t.hasAttribute("data-append-children")||t.hasAttribute("data-prepend-children"))&&(e.preventDefault(),n({url:t.action,method:t.method,data:new FormData(t),replace:t.getAttribute("data-replace"),replaceChildren:from.getAttribute("data-replace-children"),appendChildren:from.getAttribute("data-append-children"),prependChildren:from.getAttribute("data-prepend-children"),keepTitle:t.hasAttribute("data-keep-title"),keepPath:t.hasAttribute("data-keep-path")}))}},!1),"function"==typeof e.jQuery){var a=e.jQuery;r.addEventListener("hot-swap:mutated",function(e){var t=e.data;t&&a(t.getRemovedNodes()).remove()},!1)}var d=!1;return n.enableTurbolinksProgressBarIntegration=function(){if(e.Turbolinks){if(d)return!1;var t=e.Turbolinks,n=0,i=function(){0===n++&&t.ProgressBar.start()},o=function(){0===--n&&t.ProgressBar.done()};return r.addEventListener("hot-swap:before-load",i,!1),r.addEventListener("hot-swap:loaded",o,!1),r.addEventListener("hot-swap:load-error",o,!1),d=!0,!0}throw new Error("Turbolinks not found")},n});